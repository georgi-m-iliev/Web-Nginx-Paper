<h3>Основни принципи на конфигурацията</h3>
<p>Конфигурационната система на Nginx е силно повлияна от тази на уеб сървъра Apache. Един от основните изводи, до които достига автора на Nginx, е че скалируемата и подредена конфигурация е от съществено значение за поддържането на големи и сложни уеб инфраструктури. При традиционния подход на Apache поддръжката на множество виртуални сървъри, директории и местоположения често води до хаос и сложност, особено при големи сайтове с хиляди директиви. В такива среди грешки при конфигурацията или липсата на яснота могат лесно да предизвикат нестабилност или дори срив на системата.</p>
<p>За да избегне тези проблеми, в Nginx е създадена конфигурационна система, която:</p>
<ul>
    <li>Оптимизира ежедневната работа на системните администратори;</li>
    <li>Позволява лесно разширяване и модифициране на конфигурацията при нарастване на инфраструктурата;</li>
    <li>Поддържа централизиран подход, като всички настройки са събрани в една или няколко ясно организирани конфигурационни файлове.</li>
</ul>
<p>Важно е да се отбележи, че за разлика от Apache, Nginx не поддържа разпределени конфигурации чрез файлове като .htaccess. Вместо това, всички настройки трябва да бъдат направени на централно ниво, в основния конфигурационен файл или в ясно структурирани включени файлове.</p>
<p>Този подход осигурява:</p>
<ul>
    <li>По-голяма предвидимост на поведението на сървъра;</li>
    <li>По-висока производителност, тъй като няма необходимост от динамично четене и интерпретиране на допълнителни конфигурации при всяка заявка;</li>
    <li>Подобрена сигурност, тъй като само администраторите имат достъп до глобалните конфигурационни файлове.</li>
</ul>
<h3>Директория с конфигурации и тяхната структура</h3>
<p>Конфигурацията на Nginx е изградена така, че да бъде ясна, централизирана и лесно разширяема. Всички конфигурационни файлове се съхраняват в директория специално създадена за тази цел, като в Linux дистрибуциите най-често това е /etc/nginx.</p>
<p>Сърцето на цялата конфигурация е файлът nginx.conf. Той съдържа основните настройки, необходими за стартирането на сървъра и описва глобалната структура на услугата, като:</p>
<ul>
    <li>Декларира глобални директиви;</li>
    <li>Дефинира блокове като http, server, location;</li>
    <li>Включва допълнителни конфигурационни файлове при нужда.</li>
</ul>
<p>При стартиране или презареждане на сървъра, главният процес прочита nginx.conf, валидира съдържанието му и подготвя компилирана версия на конфигурацията, която се споделя в режим само за четене с всички работни процеси.</p>
<p>Някои от поддиректориите, които съставят конфигурацията на Nginx са:</p>
<ul>
    <li>conf.d/ – директория, съдържаща допълнителни конфигурационни файлове (например настройки за виртуални хостове);</li>
    <li>sites-available/ – директория, съдържаща дефиниции на сайтове (виртуални сървъри), които могат да бъдат активирани;</li>
    <li>sites-enabled/ – символични връзки към сайтовете от sites-available/, които са реално активни;</li>
    <li>modules-enabled/ – активирани модули (главно в дистрибуции като Ubuntu);</li>
</ul>
<p>В nginx.conf обикновено е добавена директива от типа:</p>
<div class="code-editor">
    <div class="editor-header">
        /etc/nginx/nginx.conf
        <button class="copy-button">Копирай</button>
    </div>
    <pre><code>include /etc/nginx/conf.d/*.conf;</code></pre>
</div>
<p>Това указва на Nginx да зареди всички файлове с разширение .conf от директорията conf.d/ и да ги включи в крайната конфигурация. По подобен начин може да се включват и сайтове от sites-enabled/:</p>
<div class="code-editor">
    <div class="editor-header">
        /etc/nginx/nginx.conf
        <button class="copy-button">Копирай</button>
    </div>
    <pre><code>include /etc/nginx/sites-enabled/*;</code></pre>
</div>
<p>Всеки файл, който е включен чрез директива include, участва в изграждането на крайния компилиран вариант на конфигурацията, който след това се използва от всички работни процеси.</p>
<p>Тази архитектура на конфигурацията:</p>
<ul>
    <li>Позволява разделяне на големи конфигурации на по-малки и по-лесно управлявани части;</li>
    <li>Улеснява поддържането и разширяването на сървъра;</li>
    <li>Осигурява по-добра четимост и контрол върху настройките.</li>
</ul>
<h3>Стил и синтаксис на конфигурацията</h3>
<p>Конфигурационните файлове на Nginx са проектирани така, че да бъдат ясни, компактни и лесни за автоматизация, като следват C-стил синтаксис, познат на повечето системни администратори и разработчици.</p>
<h4>Основни характеристики на C-стил конфигурацията</h4>
<ul>
    <li>Използване на фигурни скоби {} за групиране на блокове от директиви;</li>
    <li>Завършване на всяка директива с точка и запетая ;;</li>
    <li>Йерархична структура – директивите са вложени логически в контексти;</li>
    <li>Подредба на кода с отстъпи, която улеснява четенето и поддръжката.</li>
</ul>
<p>Пример за типична C-стил секция в nginx.conf:</p>
<div class="code-editor">
    <div class="editor-header">
        /etc/nginx/nginx.conf
        <button class="copy-button">Копирай</button>
    </div>
    <pre><code>http {
    server {
        listen 80;
        server_name example.com;

        location / {
            root /var/www/html;
            index index.html index.htm;
        }
    }
}</code></pre>
</div>
<p>Този подход осигурява:</p>
<ul>
    <li>Логическа последователност – ясно виждане кое към какво принадлежи;</li>
    <li>Лесно разширяване на конфигурацията без загуба на четимост;</li>
    <li>Минимален риск от грешки при големи и комплексни файлове.</li>
</ul>
<h4>Разлики с Apache конфигурацията</h4>
<p>Въпреки че някои директиви в Nginx напомнят на тези в Apache (например настройките за пренаписване на URL адреси), конфигурацията на Nginx е значително по-структурирана и последователна:</p>
<ul>
    <li>В Nginx няма разпръснати конфигурации като .htaccess;</li>
    <li>Всички настройки са централизирани в основни или включени файлове;</li>
    <li>Пренаписването на правила (rewrite) изисква пряко адаптиране към синтаксиса на Nginx, тъй като механизмите се различават по начина на обработка.</li>
</ul>
<h3>Контексти на директивите</h3>
<p>Конфигурацията на Nginx е организирана в ясна йерархия от контексти, които определят къде и как могат да се използват конкретни директиви. Всеки контекст описва определено ниво на работа на сървъра &mdash; от глобалните настройки до обработката на индивидуални заявки.</p>
<p>Основни принципи за използване на контекстите:</p>
<ul>
    <li>Контекстите никога не се припокриват – например, location не може да бъде директно вложен в main контекста;</li>
    <li>Всеки контекст има строго дефиниран набор от позволени директиви;</li>
    <li>Подредбата на блоковете следва логическа структура, която прави конфигурацията ясна и предсказуема.</li>
</ul>
<p>Основните контексти в конфигурацията на Nginx са:</p>
<h4>main контекст</h4>
<p>Това е глобалният контекст, който се намира в основата на nginx.conf. В него се дефинират глобални настройки, които засягат целия сървър, като:</p>
<ul>
    <li>Брой на работните процеси (worker_processes);</li>
    <li>Потребител и група, под които ще работят процесите (user);</li>
    <li>Пътища към лог файловете (error_log, pid);</li>
    <li>Настройки за събития (events).</li>
</ul>
<h4>http контекст</h4>
<p>В http контекста се описват всички настройки, свързани с обработката на HTTP трафика. Тук могат да се дефинират:</p>
<ul>
    <li>Глобални HTTP настройки (например компресия чрез gzip, буфериране, таймаути);</li>
    <li>Правила за кеширане;</li>
    <li>Дефиниции на виртуални сървъри чрез server блокове;</li>
    <li>Включване на MIME типове (include mime.types).</li>
</ul>
<h4>server контекст</h4>
<p>В рамките на http блока се разполагат един или повече server блокове, които дефинират виртуални сървъри &mdash; отделни сайтове или приложения, слушащи на определени IP адреси и портове. Всеки server блок съдържа:</p>
<ul>
    <li>Настройки за домейни (server_name);</li>
    <li>Определяне на портове и IP адреси (listen);</li>
    <li>Препратки към SSL сертификати;</li>
    <li>Блокове за допълнителни локации (location).</li>
</ul>
<h4>location контекст</h4>
<p>Вътре в server блоковете се намират location блоковете. Те се използват за съпоставяне на заявки към определено съдържание или действия в зависимост от URL пътя. В location могат да се задават:</p>
<ul>
    <li>Пренасочвания;</li>
    <li>Правила за проксиране към външни сървъри;</li>
    <li>Директно обслужване на статични файлове;</li>
    <li>Обръщение към FastCGI, uwsgi или други приложения.</li>
</ul>
<p>Пример за location блок:</p>
<div class="code-editor">
    <div class="editor-header">
        /etc/nginx/nginx.conf
        <button class="copy-button">Копирай</button>
    </div>
    <pre><code>location /image/ {
    root /data;
}</code></pre>
</div>
<h4>upstream контекст</h4>
<p>upstream блоковете се използват за дефиниране на групи от сървъри, към които може да се препращат заявки чрез проксиране или баланс на натоварването. Например:</p>
<div class="code-editor">
    <div class="editor-header">
        /etc/nginx/nginx.conf
        <button class="copy-button">Копирай</button>
    </div>
    <pre><code>upstream backend {
    server backend1.example.com;
    server backend2.example.com;
}</code></pre>
</div>
<h4>mail контекст</h4>
<p>Този контекст е предназначен за конфигурация на пощенски прокси сървър (SMTP, IMAP, POP3). Използва се по-рядко в сравнение с HTTP функционалността, но позволява изграждането на леки и ефективни пощенски решения.</p>